# Imperishable Gate 开发日志 | 七日开发记

**[ 简体中文](devlog.md)**

>*"请在开发过程中写一个 devlog，记录你的开发过程、心路历程或者任何想说的"*

这是一个白玉楼庭师从零开始，用七天时间打造链接管理系统的故事...

---

## Day 1

**今天的主要工作：**
- 在学校复习了 Echo 框架的使用
- 在火车上（！）学习了数据库、ORM、Cobra 相关的知识


## Day 2

发现有好多不会的说，于是开始用ai

实现了ping,add,delete,list，虽说ai帮了很大忙就是了，但是我还好都能看懂
但是这些的host每次都要指定且代码中设置标志每次都要重新写

后续会增加配置文件并且将一些标志设置为PersistentFlag


## Day 3

今天真是诸事不顺，我一个小白，直接管理多对多的数据库，ai写了半天还是错的
我看了半天，问了半天，我才知道错在哪里，**然后！！！**，有更简单的方法（虽然还是有bug，但好歹很快修掉了）

**关键是！！！**，tmd这个时候还有人问我sb解压问题，我nm的真服了
本来我是想晚上写Devlog和合并分支的，但是现在有点红温，所以现在就先写一点，分支也给tmd合并了


## Day 4

**今天的主要工作：**
-终于大概是把stage3的后端功能实现了，我只能说全都是在修ai的历史遗留问题，然后现在自己又留下了一堆问题，像是response的格式不统一之类的（看我的types.go文件就知道了，简直是地狱），这些就后面再搞吧，然后确实是有点累（tmd我可是零基础的萌新），随意README后面再更新吧，就这样。


## Day 5
今天主要是在完善后端的各种handler和数据库操作

上午实现了按标签列表（ListByTag）功能，然后又搞了一堆删除操作：deleteTags_by_link、deleteNames_by_link、deleteTags_by_name

-**然后**，我发现之前的代码结构太乱了，handler里面全是数据库操作，完全没有分层

于是我开始重构，把数据库操作从handler里面分离出来，一个一个改，改了好几次才搞定

还在数据库层面加了数据长度限制，修了一堆空标签和重复标签的bug

下午又实现了按名称添加备注的功能，统一了一下命名规范


## Day 6

1. **今天** 开始搞用户系统了（我就喜欢搞这个）

2. 首先是用户模型，然后实现注册和登录，用bcrypt加密密码

3. **然后！！！** 开始搞JWT认证，一开是是用的单Token验证，后开看文档才发现要双token，给我整笑了，还得处理token过期的问题。

4. **最关键的是** 之前所有的数据库操作都没有用户权限验证
于是我又把所有的操作都加上了用户ID限制

5. 改完之后又实现了爬虫功能，可以自动爬取链接的元数据，还能定时检测网站变化并发邮件通知

6. 晚上把service层的错误类型也规范了一下

## Day 7

1. 今天主要搞客户端，之前的客户端太简陋了

2. 首先实现了login命令，用了keyring这个库来安全存储，因为要用到系统的keyring，所以我的wsl都不能用，用的windows测试，后面打算用AI写README加上如何配置

3. 又实现了自动刷新token的功能

4. **但是**，我 ~~(早就)~~ 发现客户端代码写的一团糟，每个命令逻辑都是一坨
于是又开始重构：提取业务逻辑到service层，创建统一的HTTP client
把add、delete、list、login这些命令都重写了一遍
，还实现了watch功能，可以监控链接变化

## Day 8

**大量重构（应该）**


1. esponse 类型乱七八糟的, 统一了所有的 response 类型

2. 把之前那些什么 ListResponse、ListByTagResponse、ListByNameResponse 全合并了,就用一个 Response 类型

3. 错误处理也不统一（写的时候一时爽，后面自己都看不懂）,实现open命令,还加了分页功能，之前list的时候链接多了就全显示，现在可以分页了

4. 把爬虫的定时间隔从6秒改成了3小时，之前那个间隔简直是在ddos自己，测试的时候忘改了

## Day 9

1. 我之前立了个flag，今天写完1.0.0，但似乎我高估了自己，但总算在AI的帮助下（今天真的是大量使用AI）赶上 了DDL

2. 今天完整实现邮箱验证功能（注册验证、重发验证码），实现密码重置功能（邮箱/用户名），添加验证码和 token 生成器

3. 新命令，search - 关键词模糊搜索，open - 浏览器打开链接，whoami、logout，分页功能

4. 重构所有客户端命令，提取服务层，统一响应类型和错误处理，URL 标准化工具，优化元数据爬取（异步）

5. 完整中英文文档系统。东方 Project 主题 README

6. 多数据库支持（默认 SQLite，毕竟不需要配置，很方便）

9. 修复定时抓取间隔（6秒→3小时）

10. 邮箱唯一约束

## Day 10

- 虽然 1.0.0 已经完成(我应该发pre-release的)，但这只是开始，今天修了一点问题，邮件发送支持了TLS，因为我发现腾讯云这种云服务器会屏蔽25端口（），而且我发现客户端的env文件的优先级竟然高于系统环境变量，修复了这个问题


## Day 11
1. 日志系统完善（主要是AI做的，我已经摆了）
2. 为客户端添加了简洁输出模式，只显示链接和名字
3. 让AI写了新的邮件模板，更符合项目要求（确信）

## Day 12 (The end? The Start!)
今天修复了版本号过低的问题，顺便写个总结。

说实话真是惭愧，好多东西都是ai写的，但用ai也是有个转变把，一开始是真vibe coding，ai写的东西也不怎么审，然后就是导致依托 ~~（虽然现在也是）~~ ，但后面发现了之后，就只是把一些小的逻辑交给ai，大部分都是我写的（虽然是ai教我怎么用这些第三方库的，关键是它我能持续地追问，直到我理解，网上的文章就不能这样），当然，有些东西我还是全权交给ai，例如邮箱的模板（我是真不会啊qwq），最后也算是完成了吧，总之是学到了很多，就算不过也值了（但是国庆假期好像没有了）。现在我看我的代码，也是能看懂（但是你让我熟悉库的功能我还是做不到，问ai就是有这个问题，那就是我问的指向性都比较强，导致学的不全面，以后我会更深入了解我用到的哪些库的）。但是还有一些很神奇的地方，我都很想知道当时为什么要这么写，但是既然能运行，而且其实问题不大，我就不管了。

所以这不是结束，更是一个开始。

~~（因为我要开始玩东方永夜抄和妖妖梦了）~~