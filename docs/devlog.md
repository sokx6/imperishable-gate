# Imperishable Gate 开发日志 | 七日开发记

**[📖 简体中文](devlog.md)**

> 📖 *"请在开发过程中写一个 devlog，记录你的开发过程、心路历程或者任何想说的"*

这是一个白玉楼庭师从零开始，用七天时间打造链接管理系统的故事...

---

## 🌸 Day 1 | Stage 1-2 启动：白銀之春

**今天的主要工作：**
- 在学校复习了 Echo 框架的使用
- 在火车上（！）学习了数据库、ORM、Cobra 相关的知识

**感想：**
发现有好多不会的，于是开始用 AI 辅助开发。实现了 ping、add、delete、list 四个基本功能，虽说 AI 帮了很大忙，但是我还好都能看懂。

**遇到的问题：**
- 每次都要指定 host，很麻烦
- 代码中设置标志（flag）每次都要重新写

**TODO：**
- 后续会增加配置文件
- 将一些标志设置为 PersistentFlag

---

## 🏠 Day 2 | Stage 2 进行中：迷途之家の黒猫

**配置文件和持久化标志**

---

## 🎭 Day 3 | Stage 3 启动：人偶裁判の夜

**今天的主要工作：**
- 开始实现标签系统的多对多关联

**血泪史：**
今天真是诸事不顺！我一个小白，直接管理多对多的数据库关系，AI 写了半天还是错的。我看了半天，问了半天，我才知道错在哪里。

**然后！！！** 发现有更简单的方法（虽然还是有 bug，但好歹很快修掉了）

**关键是！！！** 这个时候还有人问我 sb 解压问题，我 nm 的真服了...

本来我是想晚上写 Devlog 和合并分支的，但是现在有点红温，所以现在就先写一点，分支也给 tmd 合并了。

---

## 🌸 Day 4 | Stage 3 继续：人偶裁判の夜

**今天的主要工作：**
终于大概是把 Stage 3 的后端功能实现了！

**问题一大堆：**
- 全都是在修 AI 的历史遗留问题
- 现在自己又留下了一堆问题
- Response 的格式不统一（看我的 types.go 文件就知道了，简直是地狱）

这些就后面再搞吧。确实是有点累（tmd 我可是零基础的萌新），所以 README 后面再更新吧，就这样。

---

## 🏗️ Day 5 | Stage 3 重构：代码的重生

**今天的主要工作：**
- 上午实现了按标签列表（ListByTag）功能
- 实现了一堆删除操作：deleteTags_by_link、deleteNames_by_link、deleteTags_by_name

**重构开始：**
**然后！** 我发现之前的代码结构太乱了，handler 里面全是数据库操作，完全没有分层。

于是我开始重构，把数据库操作从 handler 里面分离出来：
- 一个一个改，改了好几次才搞定
- 在数据库层面加了数据长度限制
- 修了一堆空标签和重复标签的 bug
- 下午又实现了按名称添加备注的功能
- 统一了一下命名规范

---

## 🔐 Day 6 | Stage 6 启动：冥界大小姐の亡骸

**今天** 开始搞用户系统了！

**实现内容：**
1. 首先是用户模型，然后实现注册和登录，用 bcrypt 加密密码（不会明文存密码的吧？）
2. **然后！！！** 开始搞 JWT 认证
   - 一开始是用的单 Token 验证
   - 后来看文档才发现要双 token（Access + Refresh）
   - 给我整笑了，还得处理 token 过期的问题

**最关键的是：**
之前所有的数据库操作都没有用户权限验证！于是我又把所有的操作都加上了用户 ID 限制。

**Stage 4 功能：**
改完之后又实现了爬虫功能：
- 可以自动爬取链接的元数据
- 还能定时检测网站变化并发邮件通知

晚上把 service 层的错误类型也规范了一下。

---

## 💻 Day 7 | Stage 5-6：客户端完善

**今天主要搞客户端**，之前的客户端太简陋了。

**实现内容：**
1. 首先实现了 login 命令
   - 用了 keyring 这个库来安全存储 token
   - 因为要用到系统的 keyring，所以我的 WSL 都不能用
   - 只能用 Windows 测试（后面写 README 打算用 AI 写如何配置）
2. 又实现了自动刷新 token 的功能

**但是！**
我 ~~(早就)~~ 发现客户端代码写的一团糟，每个命令逻辑都是一坨。

**重构第二弹：**
于是又开始重构：
- 提取业务逻辑到 service 层
- 创建统一的 HTTP client
- 把 add、delete、list、login 这些命令都重写了一遍
- 还实现了 watch 功能，可以监控链接变化

---

## 🚀 Day 8 | 大重构：响应的统一

**大量重构（应该）**

**问题描述：**
- Response 类型乱七八糟的
- 错误处理也不统一（写的时候一时爽，后面自己都看不懂）

**今天的工作：**
于是我今天花了一整天在重构：
- 统一了所有的 response 类型
- 把之前那些什么 ListResponse、ListByTagResponse、ListByNameResponse 全 tm 合并了
- 就用一个 Response 类型
然后把所有的错误处理改成用errors.Is
还给所有的命令都加了完整的service层，
**然后** 我又实现open命令
还加了分页功能，之前list的时候链接多了就全显示，现在可以分页了
实现了用户注册命令，给邮箱加了唯一约束
**最后！！！** 把爬虫的定时间隔从6秒改成了3小时，之前那个间隔简直是在ddos自己，测试的时候忘改了